syntax = "proto3";
package qutlas.proto;

option go_package = "qutlas/proto";

message BoundingBox {
  double min_x = 1;
  double min_y = 2;
  double min_z = 3;
  double max_x = 4;
  double max_y = 5;
  double max_z = 6;
}

message AssetRequest {
  string asset_id = 1;        // optional client-specified id
}

message AssetResponse {
  string asset_id = 1;
  string status = 2;
  BoundingBox bounds = 3;
  int64 vertex_count = 4;
  int64 face_count = 5;
  string error = 6;
}

message FileRequest {
  string filename = 1;
  bytes data = 2;   // contents of step/iges/stl
}

message FileResponse {
  string status = 1;
  bytes data = 2;   // exported file bytes
  string error = 3;
}

message BooleanRequest {
  string target_handle = 1;
  string tool_handle = 2;
  string operation = 3; // union: "union","cut","common"
  double tolerance = 4;
}

message FilletRequest {
  string target_handle = 1;
  repeated uint64 edge_ids = 2; // engine-specific edge IDs or empty -> auto
  double radius = 3;
  double tolerance = 4;
}

message GeometryResponse {
  string status = 1;
  string error = 2;
}

message MeshRequest {
  string handle = 1;
  double deflection = 2;
  int32 linear_deflection = 3;
}

message MeshChunk {
  bytes chunk = 1;
}

service GeometryService {
  rpc LoadAsset(AssetRequest) returns (AssetResponse);
  rpc ImportStep(FileRequest) returns (AssetResponse);
  rpc ExportStep(FileRequest) returns (FileResponse);
  rpc Boolean(BooleanRequest) returns (GeometryResponse);
  rpc Fillet(FilletRequest) returns (GeometryResponse);
  rpc GenerateMesh(MeshRequest) returns (stream MeshChunk); // stream glTF/draco bytes
}
